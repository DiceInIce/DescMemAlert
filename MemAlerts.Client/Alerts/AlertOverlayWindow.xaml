<Window x:Class="MemAlerts.Client.Alerts.AlertOverlayWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        SizeToContent="WidthAndHeight"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        ShowInTaskbar="True"
        ResizeMode="NoResize">
    <Border Background="{DynamicResource SurfaceBrush}"
            CornerRadius="14"
            Padding="0"
            BorderBrush="{DynamicResource BorderColor}"
            BorderThickness="2">
        <Border.Effect>
            <DropShadowEffect BlurRadius="32" ShadowDepth="6" Opacity="0.6" Color="#000000" Direction="315" />
        </Border.Effect>
        
        <Border CornerRadius="12"
                Padding="1"
                Background="{DynamicResource PrimaryGradient}">
            <Border Background="{DynamicResource CardBrush}"
                    CornerRadius="14">
                <StackPanel>
                    <Border Background="{DynamicResource ToolbarBrush}"
                            CornerRadius="14"
                            Padding="18"
                            Margin="0,0,0,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Orientation="Horizontal">
                                <Border Width="44"
                                        Height="44"
                                        CornerRadius="22"
                                        Background="{StaticResource PrimaryGradient}"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                    <materialDesign:PackIcon Kind="PlayCircle"
                                                             Width="26"
                                                             Height="26"
                                                             Foreground="White"
                                                             VerticalAlignment="Center"
                                                             HorizontalAlignment="Center"/>
                                </Border>
                                <StackPanel Margin="12,0,0,0">
                                    <TextBlock Text="{Binding Video.Title}"
                                               FontSize="20"
                                               FontWeight="SemiBold"
                                               Foreground="White"
                                               TextTrimming="CharacterEllipsis"
                                               MaxWidth="340"/>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding ViewerName, StringFormat='от {0}'}"
                                                   FontSize="13"
                                                   Foreground="#BDBDBD" />
                                        <TextBlock Text="{Binding Video.Duration, StringFormat=' · {0:mm\\:ss}'}"
                                                   FontSize="13"
                                                   Foreground="#BDBDBD"
                                                   Margin="6,0,0,0" />
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="1"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center">
                                <Button Width="32"
                                        Height="32"
                                        Padding="0"
                                        Background="#1F000000"
                                        BorderBrush="#33FFFFFF"
                                        Click="CloseButton_Click"
                                        Cursor="Hand">
                                    <materialDesign:PackIcon Kind="Close"
                                                             Width="16"
                                                             Height="16"
                                                             Foreground="White" />
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Border Background="{DynamicResource SurfaceBrush}"
                            CornerRadius="12"
                            Padding="14"
                            Margin="0,0,0,16"
                            BorderBrush="{DynamicResource BorderColor}"
                            BorderThickness="1">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Message}" Value="">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Message}" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="MessageText"
                                                     Width="18"
                                                     Height="18"
                                                     Foreground="{DynamicResource AccentBrush}"
                                                     Margin="0,2,8,0" />
                            <TextBlock Text="{Binding Message}"
                                       Foreground="White"
                                       TextWrapping="Wrap"
                                       FontSize="13"
                                       MaxWidth="420" />
                        </StackPanel>
                    </Border>
                    
                    <Grid HorizontalAlignment="Center">
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Border x:Name="VideoContainer"
                                Grid.Row="0"
                                Background="{DynamicResource BackgroundDark}"
                                CornerRadius="12"
                                BorderBrush="{DynamicResource BorderColor}"
                                BorderThickness="1"
                                Padding="2"
                                Width="640"
                                Height="360">
                            <Grid>
                                <MediaElement x:Name="OverlayPlayer"
                                              LoadedBehavior="Manual"
                                              UnloadedBehavior="Manual"
                                              Stretch="Uniform"
                                              MediaEnded="OverlayPlayer_OnMediaEnded"
                                              MediaOpened="OverlayPlayer_OnMediaOpened"
                                              MediaFailed="OverlayPlayer_OnMediaFailed" />
                                              
                                <wv2:WebView2 x:Name="OverlayWebView"
                                              Visibility="Collapsed"/>
                            </Grid>
                        </Border>
                        
                        <Border Grid.Row="1"
                                Background="{DynamicResource PrimaryGradient}" 
                                CornerRadius="0,0,12,12" 
                                Margin="0,-8,0,0" 
                                Padding="12,8,12,4"
                                Panel.ZIndex="-1"
                                Width="{Binding ElementName=VideoContainer, Path=ActualWidth}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                
                                <Button Grid.Column="0"
                                        Style="{StaticResource MaterialDesignIconForegroundButton}"
                                        Foreground="White"
                                        Click="MuteButton_Click"
                                        Width="32" Height="32"
                                        Padding="0"
                                        Margin="0,0,8,0">
                                    <materialDesign:PackIcon x:Name="MuteIcon" Kind="VolumeHigh" Width="16" Height="16"/>
                                </Button>
                                
                                <Slider Grid.Column="1"
                                        x:Name="OverlayVolumeSlider"
                                        Minimum="0" Maximum="100" Value="100"
                                        VerticalAlignment="Center"
                                        ValueChanged="VolumeSlider_ValueChanged"
                                        IsMoveToPointEnabled="True"
                                        Style="{StaticResource MaterialDesignSlider}"
                                        HorizontalAlignment="Stretch"
                                        Margin="0,4,0,0"/>
                            </Grid>
                        </Border>
                    </Grid>
                </StackPanel>
            </Border>
        </Border>
    </Border>
</Window>
